<?xml version="1.0"?>
<queries>
	<query>
		<name>findByPK</name>
		<sql>SELECT * FROM STUDY_EVENT WHERE 
		STUDY_EVENT_ID = ?</sql>
	</query>
	<query>
		<name>findAllByDefinition</name>
		<sql>SELECT * FROM STUDY_EVENT WHERE 
		STUDY_EVENT_DEFINITION_ID = ?</sql>
	</query>
	<query>
		<name>findAllWithSubjectLabelByDefinition</name>
		<sql>
		    select se.*, ss.label from study_event se, study_subject ss
             where se.study_event_definition_id=?
             and se.study_subject_id = ss.study_subject_id
        </sql>
	</query>
	<query>
		<name>findCRFsByStudyEvent</name>
		<sql>SELECT C.CRF_ID, C.STATUS_ID, C.NAME, C.DESCRIPTION,
		V.CRF_VERSION_ID, V.NAME, V.REVISION_NOTES FROM CRF C, 
		CRF_VERSION V, EVENT_DEFINITION_CRF EDC 
		WHERE C.CRF_ID = V.CRF_ID
		AND EDC.CRF_ID = C.CRF_ID
		AND EDC.STUDY_EVENT_DEFINITION_ID =?</sql>
	</query>
	<query>
		<name>findCRFsByStudy</name>
		<sql>
			SELECT DISTINCT
				C.CRF_ID
				, C.NAME AS CRF_NAME
				, C.DESCRIPTION
				, V.CRF_VERSION_ID
				, V.NAME AS VER_NAME
				, V.REVISION_NOTES
				, SED.STUDY_EVENT_DEFINITION_ID
				, SED.NAME AS SED_NAME
			FROM
				CRF C
				, CRF_VERSION V
				, EVENT_DEFINITION_CRF EDC
				, STUDY_EVENT_DEFINITION SED
			WHERE
     			C.CRF_ID = V.CRF_ID
     			AND EDC.CRF_ID = C.CRF_ID
     			AND EDC.STUDY_EVENT_DEFINITION_ID = SED.STUDY_EVENT_DEFINITION_ID
     			AND SED.STATUS_ID = 1
     			AND SED.STUDY_ID = ? 
     		ORDER BY C.CRF_ID, V.CRF_VERSION_ID
     	</sql>
	</query>
	<query>
		<name>findAll</name>
		<sql>SELECT * FROM STUDY_EVENT</sql>
	</query>
	<query>
		<name>findAllByDefinitionAndSubject</name>
		<sql>SELECT * FROM study_event WHERE study_event_definition_id=? AND study_subject_id=?</sql>
	</query>
    <query>
		<name>findAllByDefinitionAndSubjectOrderByOrdinal</name>
		<sql>SELECT * FROM study_event 
             WHERE study_event_definition_id=? 
            AND study_subject_id=?
            order by sample_ordinal asc
           
       </sql>
	</query>
	<query>
		<name>create</name>
		<sql>
		   INSERT INTO STUDY_EVENT 
		   (STUDY_EVENT_ID,STUDY_EVENT_DEFINITION_ID,STUDY_SUBJECT_ID,LOCATION,SAMPLE_ORDINAL,
            DATE_START,DATE_END,OWNER_ID,STATUS_ID,DATE_CREATED,subject_event_status_id,
            STUDY_TEMPLATE_EVENT_DEF_ID, SUMMARY_DATA_ENTRY_STATUS_ID) 
            VALUES (?,?,?,?,?,?,?,?,?,SYSDATE,?,?,?)
		</sql>
	</query>
	<query>
		<name>update</name>
		<sql>
		  UPDATE study_event SET STUDY_EVENT_DEFINITION_ID=?,STUDY_SUBJECT_ID=?,LOCATION=?,
		  SAMPLE_ORDINAL=?, DATE_START=?,DATE_END=?,STATUS_ID=?,DATE_UPDATED=?,
          UPDATE_ID=? , subject_event_status_id=?, study_template_event_def_id=?, summary_data_entry_status_id=?
          WHERE STUDY_EVENT_ID=?
	    </sql>
	</query>
	<query>
		<name>getCurrentPrimaryKey</name>
		<sql>SELECT study_event_seq.currval AS key FROM DUAL</sql>
	</query>
	<query>
		<name>getNextPrimaryKey</name>
		<sql>SELECT study_event_seq.nextval AS key FROM DUAL</sql>
	</query>
		<query>
		<name>findAllByStudyAndStudySubjectId</name>
		<sql>
			SELECT E.*
			FROM study_subject S, study_event E, study st
			WHERE
				S.study_subject_id = E.study_subject_id
				AND S.study_id = st.study_id
				AND (st.study_id = ? or st.parent_study_id=?)
				AND S.study_subject_id=?
		</sql>
	</query>
	<query>
		<name>findAllByStudyAndEventDefinitionId</name>
		<sql>
			SELECT E.*
			FROM study_event_definition S, study_event E, study st
			WHERE
				S.study_event_definition_id = E.study_event_definition_id
				AND S.study_id = st.study_id
				AND (st.study_id = ? or st.parent_study_id=?)
				AND S.study_event_definition_id = ?
		</sql>
	</query>
	<query>
		<name>findByPKAndStudy</name>
		<sql>
			SELECT E.*
			FROM study_subject S, study_event E, study st
			WHERE
				S.study_subject_id = E.study_subject_id
				AND E.study_event_id=?
				AND S.study_id = st.study_id 
				AND (st.study_id = ? or st.parent_study_id=?)
		</sql>
	</query>
	<query>
		<name>getDefinitionIdFromStudyEventId</name>
		<sql>SELECT study_event_definition_id FROM study_event WHERE study_event_id = ?</sql>
	</query>
	<query>
	  <name>findAllBySubjectAndStudy</name>
	  <sql>
	  	select se.*
	  	from study_event se, study_subject ss, study st
	  	where se.study_subject_id=?
	  		and se.study_subject_id = ss.study_subject_id
	  		and ss.study_id=st.study_id
	       	and (st.study_id = ? or st.parent_study_id=?)
	  </sql>
	</query>
	<query>
	  <name>findAllBySubjectId</name>
	  <sql>
	  	select se.*
	  	from study_event se, study_subject ss
		where se.study_subject_id = ss.study_subject_id
			and ss.subject_id=?
	  </sql>
	</query>
	<query>
		<name>findAllByStudySubject</name>
		<sql>
         SELECT se.* FROM study_event se, study_event_definition sed 
         WHERE se.study_subject_id=?
         and se.study_event_definition_id= sed.study_event_definition_id
         ORDER BY sed.ordinal asc , se.sample_ordinal desc
         </sql>
	</query>
    <query>
		<name>findAllByStudySubjectAndDefinition</name>
		<sql>
         SELECT se.* FROM study_event se, study_event_definition sed 
         WHERE se.study_subject_id=? 
         and sed.study_event_definition_id=?
         and se.study_event_definition_id= sed.study_event_definition_id         
         ORDER BY sed.ordinal asc , se.sample_ordinal desc
         </sql>
	</query>
	<query>
		<name>findAllByTemplateAndStudySubject</name>
		<sql>
         SELECT distinct se.* , sed.ordinal FROM study_event se, study_template_event_def sted,
         study_event_definition sed
         WHERE  sted.study_template_id=?
		 and sted.study_template_event_def_id = se.study_template_event_def_id		
         and se.study_event_definition_id= sed.study_event_definition_id
		 and se.study_subject_id=?   
		 order by sed.ordinal  
         
         </sql>
	</query>	
		
	<query>
		<name>getMaxSampleOrdinal</name>
		<sql>
			SELECT max(sample_ordinal) AS max_ord
			FROM study_event
			WHERE study_event_definition_id=? AND study_subject_id=?
		</sql>
	</query>
	<query>
		<name>createWithStudySubject</name>
		<sql>
		   INSERT INTO STUDY_EVENT 
		   (STUDY_EVENT_DEFINITION_ID,STUDY_SUBJECT_ID,LOCATION,SAMPLE_ORDINAL,
            DATE_START,DATE_END,OWNER_ID,STATUS_ID,DATE_CREATED,subject_event_status_id,
            STUDY_TEMPLATE_EVENT_DEF_ID, SUMMARY_DATA_ENTRY_STATUS_ID) 
            VALUES (?,study_subject_seq.currval,?,?,?,?,?,?,SYSDATE,?,?,?)
		</sql>
	</query>
</queries>